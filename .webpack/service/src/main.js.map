{"version":3,"file":"src/main.js","mappings":"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","sources":["webpack://desafio-toro-backend/./src/adapters/in/adapter.in.module.ts","webpack://desafio-toro-backend/./src/adapters/in/controllers/auth.controller.ts","webpack://desafio-toro-backend/./src/adapters/in/controllers/wallet.controller.ts","webpack://desafio-toro-backend/./src/adapters/in/interceptor/user.interceptor.ts","webpack://desafio-toro-backend/external commonjs \"@nestjs/common\"","webpack://desafio-toro-backend/external commonjs \"@nestjs/config\"","webpack://desafio-toro-backend/external commonjs \"@nestjs/core\"","webpack://desafio-toro-backend/external commonjs \"helmet\"","webpack://desafio-toro-backend/webpack/bootstrap","webpack://desafio-toro-backend/./src/main.ts"],"sourcesContent":["import { ApplicationModule } from '@application/application.module';\r\nimport { Module } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\nimport { APP_INTERCEPTOR } from '@nestjs/core';\r\nimport { AuthController } from './controllers/auth.controller';\r\nimport { WalletController } from './controllers/wallet.controller';\r\nimport { UserInterceptor } from './interceptor/user.interceptor';\r\n\r\n@Module({\r\n  imports: [ConfigModule.forRoot({ isGlobal: true }), ApplicationModule],\r\n  controllers: [WalletController, AuthController],\r\n  providers: [\r\n    {\r\n      provide: APP_INTERCEPTOR,\r\n      useClass: UserInterceptor,\r\n    },\r\n  ],\r\n})\r\nexport class AdapterInModule {}\r\n","import { IAuthService } from '@application/in/auth.interface';\r\nimport { Controller, Get, Inject } from '@nestjs/common';\r\nimport { Headers } from '@nestjs/common';\r\n\r\nimport { Providers } from 'domain/enums';\r\n\r\n@Controller('auth')\r\nexport class AuthController {\r\n  constructor(\r\n    @Inject(Providers.I_AUTH_SERVICE)\r\n    private authService: IAuthService,\r\n  ) {}\r\n\r\n  @Get('login')\r\n  login(@Headers() headers: any) {\r\n    return this.authService.login(headers.token);\r\n  }\r\n}\r\n","import { IWalletService } from '@application/in';\r\nimport { JwtAuthGuard } from '@application/jwt/jwt-auth.guard';\r\nimport {\r\n  Controller,\r\n  Inject,\r\n  Get,\r\n  UseGuards,\r\n  Req,\r\n  Post,\r\n  Body,\r\n} from '@nestjs/common';\r\nimport { OrderPositionDTO, WalletDTO } from 'domain/dto';\r\nimport { StocksDTO } from 'domain/dto/stocks.dto';\r\nimport { Providers } from 'domain/enums';\r\n\r\n@Controller('')\r\nexport class WalletController {\r\n  constructor(\r\n    @Inject(Providers.I_ACCOUNT_SERVICE)\r\n    private accountService: IWalletService,\r\n  ) {}\r\n  @Get('userPosition')\r\n  @UseGuards(JwtAuthGuard)\r\n  getWallet(@Req() req: any): Promise<WalletDTO> {\r\n    return this.accountService.getWallet(req.user.id);\r\n  }\r\n  @Get('trends')\r\n  @UseGuards(JwtAuthGuard)\r\n  getTopFiveStocks(): Promise<StocksDTO[]> {\r\n    return this.accountService.getTopFiveStocks();\r\n  }\r\n\r\n  @Post('order')\r\n  @UseGuards(JwtAuthGuard)\r\n  orderStocks(\r\n    @Body() orderStock: OrderPositionDTO,\r\n    @Req() req: any,\r\n  ): Promise<WalletDTO> {\r\n    return this.accountService.orderStocks(orderStock, req.user.id);\r\n  }\r\n}\r\n","import { IAuthService } from '@application/in/auth.interface';\r\nimport {\r\n  CallHandler,\r\n  ExecutionContext,\r\n  Inject,\r\n  Injectable,\r\n  NestInterceptor,\r\n} from '@nestjs/common';\r\nimport { Providers } from 'domain/enums';\r\n\r\n@Injectable()\r\nexport class UserInterceptor implements NestInterceptor {\r\n  constructor(\r\n    @Inject(Providers.I_AUTH_SERVICE)\r\n    private authService: IAuthService,\r\n  ) {}\r\n  private getTokenFromAuthorization = (authorization = '') => {\r\n    const split = authorization.split(' ');\r\n\r\n    return split[1];\r\n  };\r\n  async intercept(context: ExecutionContext, next: CallHandler) {\r\n    const request = context.switchToHttp().getRequest();\r\n\r\n    const item = await this.authService.getUserByToken(\r\n      this.getTokenFromAuthorization(request.headers.authorization),\r\n    );\r\n\r\n    request.user = item;\r\n\r\n    return next.handle();\r\n  }\r\n}\r\n","module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/config\");","module.exports = require(\"@nestjs/core\");","module.exports = require(\"helmet\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { NestFactory } from '@nestjs/core';\r\nimport {\r\n  Handler,\r\n  Context,\r\n  Callback,\r\n  APIGatewayProxyEventV2,\r\n  APIGatewayProxyResultV2,\r\n} from 'aws-lambda';\r\nimport helmet from 'helmet';\r\nimport { AdapterInModule } from './adapters/in/adapter.in.module';\r\n\r\nlet server: Handler;\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AdapterInModule);\r\n  app.enableCors();\r\n  if (process.env.INIT_HELMET === 'true') {\r\n    app.use(\r\n      helmet({\r\n        contentSecurityPolicy:\r\n          process.env.NODE_ENV === 'production' ? undefined : false,\r\n      }),\r\n    );\r\n  }\r\n  await app.listen(process.env.PORT, () =>\r\n    console.log('App running on port', process.env.PORT),\r\n  );\r\n}\r\nbootstrap();\r\n\r\nexport const handler: Handler = async (\r\n  event: APIGatewayProxyEventV2,\r\n  context: Context,\r\n  callback: Callback,\r\n): Promise<APIGatewayProxyResultV2> => {\r\n  server = server ?? (await bootstrap());\r\n  return server(event, context, callback);\r\n};\r\n"],"names":[],"sourceRoot":""}